# ユーザIDはセッションからとりましょう#-----------------------------------------------------# ヘッダ部分(ユーザ番号と名前)SELECT 	*FROM	user_infWHERE	id = {{ユーザID}}#-----------------------------------------------------#-----------------------------------------------------# 告知領域SELECT 	message_title	,message_content	,send_dateFROM	message_infWHERE	id IN (		SELECT			message_key		FROM			message_to		WHERE			user_key = {{ユーザID}}		AND			check_datetime IS NULL	)ORDER BY send_date DESC#-----------------------------------------------------#-----------------------------------------------------# 予約済(受講済)授業SELECT	user_classwork_cost	,user_classwork_cost_aj	,get_point	,flower_cost	,flower_cost_aj	,extension_cost	,lesson_name	,school_name	,start_time	,end_time	,lesson_date    ,today    ,lesson_key	,id	,biggest_students	,MAX(point_rate) AS point_rate	,students	,order_students    ,user_work_statusFROM (SELECT 	user_classwork_cost	,user_classwork_cost_aj	,user_classwork.get_point AS get_point	,flower_cost	,flower_cost_aj	,user_classwork.extension_cost AS extension_cost	,lesson_name	,school_name	,start_time	,end_time	,time_table_day.lesson_date AS lesson_date	,lesson_point_rate.point_rate AS point_rate	,students	,order_students    ,SUBSTRING(NOW(), 1,10) AS today    ,user_classwork.stage_no AS stage_no	,user_classwork.level_no AS level_no    ,classwork.lesson_key AS lesson_key	,user_classwork.id as id	,biggest_students    ,user_work_status	,classwork.id AS classwork_keyFROM 	user_classworkINNER JOIN	classworkON	classwork.id = user_classwork.classwork_keyAND		user_classwork.user_key = {{ユーザID}}INNER JOIN 	lesson_infON	lesson_inf.id = classwork.lesson_keyINNER JOIN	school_infON		school_inf.id = lesson_inf.school_keyINNER JOIN	time_table_dayON	time_table_day.id = classwork.time_table_day_keyINNER JOIN	timetable_infON	timetable_inf.id = time_table_day.timetable_keyLEFT JOIN	(        SELECT            MAX(students) AS biggest_students            ,lesson_key		FROM            lesson_point_rate        GROUP BY            lesson_key	    ) AS lspON    lsp.lesson_key = lesson_inf.idAND 	order_students > biggest_studentsINNER JOIN	lesson_point_rateON	lesson_point_rate.lesson_key = lesson_inf.idAND(	students <= order_studentsOR	biggest_students IS NOT NULL)) AS student_class_recGROUP BY    id#-----------------------------------------------------#-----------------------------------------------------# キャンセル料(率)# レッスンIDはリスト出力で取得したものをViewから送ってもらうSELECT	*FROM	lesson_cancel_rateWHERE	lesson_key = {レッスンID}#-----------------------------------------------------#-----------------------------------------------------# 受講可能レッスンSELECT     lesson_name    ,id AS lesson_keyFROM    lesson_infWHERE    id in(        SELECT             lesson_key        FROM            user_lesson        WHERE            user_key = {{user_key}}        AND            rec_status = 0    )AND	rec_status = 0;# 授業の枠有無チェック用クエリ#重複行を取得しない(各日付を1行だけ取得する)SELECT DISTINCT	#授業日付を取得	lesson_date#データ取得対象を指定FROM 	#授業時間帯テーブル	`time_table_day`#検索条件指定WHERE	#授業の日付の期間を指定する	lesson_date >= 'fromDate' 	AND lesson_date <= 'toDate';# ログインユーザの授業予約状況チェック用クエリSELECT DISTINCT 	lesson_date	,user_work_status FROM 	`user_classwork` INNER JOIN 	classwork ON 	user_classwork.classwork_key = classwork.id INNER JOIN 	time_table_day ON 	classwork.time_table_day_key = time_table_day.id WHERE 	lesson_date >= 'fromDate' AND 	lesson_date <= 'toDate' AND 	user_key = 'user_key';